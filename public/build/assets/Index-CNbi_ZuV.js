import{r as v,d as V,c as G,w as C,b as m,a as e,h as p,p as H,f as n,g as d,x as J,i as j,o,t as l,F as x,j as k,e as S,q as W,n as Y,s as L,v as B,A as Z,y as ee}from"./app-9iTwA3vC.js";import{A as te}from"./AdminLayout-BNATRJWW.js";import{_ as O}from"./Modal-DiBLSjck.js";import{r as se}from"./ArrowLeftIcon-BfYZPnun.js";import{r as A}from"./CheckCircleIcon-gOQAQdUW.js";import{r as le}from"./ExclamationCircleIcon-CQliQA0u.js";import{r as oe}from"./UserGroupIcon-Cz7EhKcJ.js";import{r as U}from"./ArrowPathIcon-DJSBMRrW.js";import{r as ne}from"./InformationCircleIcon-BC7EG6Si.js";import"./DropdownLink-BJxGAADP.js";import"./NavLink-CVNpfdyq.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./XMarkIcon-DR50bQrw.js";import"./UsersIcon-Dq-ijHz8.js";import"./ChatBubbleLeftRightIcon-B5E4Bl1m.js";import"./ChartBarIcon-DGOEscCD.js";import"./CurrencyDollarIcon-BD-2biuk.js";import"./EyeIcon-DsHcOT47.js";const ae={class:"py-6"},ie={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},re={class:"mb-8"},de={class:"flex justify-between items-start"},ue={key:0,class:"mb-4"},ce={class:"rounded-md bg-green-50 p-4"},me={class:"flex"},ve={class:"flex-shrink-0"},pe={class:"ml-3"},fe={class:"text-sm font-medium text-green-800"},xe={key:0,class:"mt-2 text-sm text-green-700"},ge={key:1,class:"mb-4"},_e={class:"rounded-md bg-red-50 p-4"},be={class:"flex"},ye={class:"flex-shrink-0"},he={class:"ml-3"},we={class:"mt-2 text-sm text-red-700"},ke={class:"list-disc pl-5 space-y-1"},Se={class:"grid grid-cols-1 lg:grid-cols-3 gap-8"},Ce={class:"lg:col-span-2 space-y-6"},je={class:"bg-white shadow rounded-lg"},$e={class:"p-6"},Ie={class:"space-y-4"},Ee=["disabled"],Ve=["value"],Ae={key:0,class:"mt-2 text-sm text-red-600"},Ue={key:0,class:"border border-gray-200 rounded-lg p-4 bg-gray-50"},Ne={class:"flex items-start justify-between"},Te={class:"font-semibold text-gray-900"},Fe={class:"mt-2 grid grid-cols-2 gap-4"},Me={class:"text-sm text-gray-900"},De={class:"text-sm text-gray-900 capitalize"},Le={class:"text-sm text-gray-900"},Be={class:"text-sm text-gray-900"},Oe={class:"bg-white shadow rounded-lg"},Pe={class:"px-6 py-4 border-b border-gray-200"},ze={class:"flex justify-between items-center"},qe={class:"flex space-x-2"},Re={class:"p-6"},Ke={class:"mb-4"},Qe={class:"space-y-3 max-h-96 overflow-y-auto"},Xe={class:"flex items-center space-x-3"},Ge=["id","value"],He={class:"flex-shrink-0"},Je={class:"h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center"},We={class:"text-sm font-medium text-blue-800"},Ye=["for"],Ze={class:"text-xs text-gray-500"},et={key:0,class:"mt-1"},tt={class:"inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800"},st={key:0,class:"text-xs text-green-600"},lt={key:0,class:"text-center py-8"},ot={class:"mt-1 text-sm text-gray-500"},nt={class:"mt-4 flex items-center justify-between text-sm text-gray-500"},at={key:0},it={class:"space-y-6"},rt={class:"bg-white shadow rounded-lg"},dt={class:"p-6"},ut={class:"space-y-4"},ct={class:"flex items-start"},mt={class:"flex items-center h-5"},vt={key:0},pt={class:"mt-2 text-xs text-gray-500"},ft={class:"bg-white shadow rounded-lg"},xt={class:"p-6"},gt={class:"space-y-4"},_t={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},bt={class:"space-y-2"},yt={class:"flex justify-between"},ht={class:"text-sm font-medium text-blue-900"},wt={class:"flex justify-between"},kt={class:"text-sm font-medium text-blue-900"},St={class:"flex justify-between"},Ct={class:"text-sm font-medium text-blue-900"},jt=["disabled"],$t={key:0,class:"text-xs text-gray-500"},It={class:"flex items-center"},Et={key:0,class:"mt-1"},Vt={class:"p-6"},At={class:"mb-4"},Ut={key:0,class:"mb-4"},Nt={class:"flex items-center justify-between text-sm text-gray-600"},Tt={key:1,class:"mb-6"},Ft={class:"rounded-md bg-gray-50 p-4"},Mt={class:"grid grid-cols-2 gap-4 text-sm"},Dt={class:"ml-2 font-medium"},Lt={class:"ml-2 font-medium"},Bt={class:"ml-2 font-medium"},Ot={key:0,class:"mt-3"},Pt={class:"text-sm"},zt={class:"mt-2 space-y-1 text-xs text-red-500"},qt={key:0},Rt={key:0,class:"mt-4"},Kt={class:"max-h-40 overflow-y-auto space-y-2"},Qt={class:"text-sm font-medium"},Xt={class:"text-xs text-gray-500"},Gt={class:"mt-6 flex justify-end space-x-3"},Ht=["disabled"],Jt={class:"p-6 text-center"},Wt={class:"text-sm text-gray-600"},Yt={class:"mt-4 bg-gray-200 rounded-full h-2"},gs={__name:"Index",props:{courses:Array,students:Array,filters:Object,selected_course:Object},setup(N){const g=N,r=v({course_id:g.filters.course_id||"",student_ids:[],send_notifications:!0,notification_message:""}),f=v(""),u=v([]),i=v(g.selected_course),$=v(!1),_=v(!1),h=v(0),w=v(!1),I=v(!1),c=v(null),E=v(null),T=v({}),F=V(()=>b.value.length>0&&u.value.length===b.value.length),M=V(()=>r.value.course_id&&u.value.length>0),b=V(()=>{if(!f.value)return g.students;const a=f.value.toLowerCase();return g.students.filter(t=>t.name.toLowerCase().includes(a)||t.email.toLowerCase().includes(a))}),P=()=>{F.value?u.value=[]:u.value=b.value.map(a=>a.id)},D=async()=>{if(!r.value.course_id){i.value=null,u.value=[];return}$.value=!0;try{const t=await(await fetch(route("admin.courses.mass-enrollment.get-eligible-students",{course:r.value.course_id,search:f.value}))).json();i.value=g.courses.find(s=>s.id==r.value.course_id),u.value=[]}catch(a){console.error("Failed to load course details:",a)}finally{$.value=!1}},z=a=>i.value?i.value.enrollments?.some(t=>t.user_id===a):!1,q=async()=>{if(r.value.course_id)try{const t=await(await fetch(route("admin.courses.mass-enrollment.get-eligible-students",{course:r.value.course_id,search:f.value}))).json()}catch(a){console.error("Failed to search students:",a)}},R=()=>{if(!M.value||(r.value.student_ids=u.value,i.value?.enrollment_limit&&i.value.current_enrollment+r.value.student_ids.length>i.value.enrollment_limit&&!confirm("This will exceed the course enrollment limit. Continue anyway?")))return;_.value=!0,h.value=0;const a=setInterval(()=>{h.value=Math.min(h.value+10,90)},500);ee.post(route("admin.courses.mass-enrollment.store"),r.value,{onFinish:()=>{clearInterval(a),_.value=!1,h.value=0},onSuccess:()=>{u.value=[],r.value.notification_message=""}})},K=async a=>{const t=a.target.files[0];if(!t||!r.value.course_id){alert("Please select a course first");return}I.value=!0,c.value=null;const s=new FormData;s.append("course_id",r.value.course_id),s.append("csv_file",t);try{const X=await(await fetch(route("admin.courses.mass-enrollment.upload-csv"),{method:"POST",headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').content},body:s})).json();c.value=X}catch(y){console.error("Upload failed:",y),alert("Failed to upload file. Please try again.")}finally{I.value=!1,E.value&&(E.value.value="")}},Q=()=>{if(c.value?.valid_students){const t=c.value.valid_students.map(s=>s.id).filter(s=>!u.value.includes(s));u.value=[...u.value,...t],w.value=!1,c.value=null}};return g.filters.course_id&&D(),(a,t)=>(o(),G(te,null,{default:C(()=>[m(p(H),{title:"Mass Enroll Students"}),e("div",ae,[e("div",ie,[e("div",re,[e("div",de,[t[10]||(t[10]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"Mass Enroll Students"),e("p",{class:"mt-2 text-gray-600"}," Enroll multiple students in a course at once. ")],-1)),m(p(J),{href:a.route("admin.courses.index"),class:"inline-flex items-center px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50"},{default:C(()=>[m(p(se),{class:"h-4 w-4 mr-2"}),t[9]||(t[9]=j(" Back to Courses ",-1))]),_:1},8,["href"])])]),a.$page.props.flash.success?(o(),n("div",ue,[e("div",ce,[e("div",me,[e("div",ve,[m(p(A),{class:"h-5 w-5 text-green-400"})]),e("div",pe,[e("h3",fe,l(a.$page.props.flash.success),1),a.$page.props.flash.details?(o(),n("div",xe,[e("p",null,"Enrolled: "+l(a.$page.props.flash.details.enrolled),1),e("p",null,"Skipped: "+l(a.$page.props.flash.details.skipped),1),e("p",null,"Total: "+l(a.$page.props.flash.details.total),1)])):d("",!0)])])])])):d("",!0),a.$page.props.flash.errors?(o(),n("div",ge,[e("div",_e,[e("div",be,[e("div",ye,[m(p(le),{class:"h-5 w-5 text-red-400"})]),e("div",he,[t[11]||(t[11]=e("h3",{class:"text-sm font-medium text-red-800"}," Some issues occurred during enrollment ",-1)),e("div",we,[e("ul",ke,[(o(!0),n(x,null,k(a.$page.props.flash.errors,s=>(o(),n("li",{key:s},l(s),1))),128))])])])])])])):d("",!0),e("div",Se,[e("div",Ce,[e("div",je,[t[18]||(t[18]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"1. Select Course")],-1)),e("div",$e,[e("div",Ie,[e("div",null,[t[13]||(t[13]=e("label",{for:"course_id",class:"block text-sm font-medium text-gray-700"}," Course * ",-1)),S(e("select",{id:"course_id","onUpdate:modelValue":t[0]||(t[0]=s=>r.value.course_id=s),onChange:D,class:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",disabled:$.value},[t[12]||(t[12]=e("option",{value:""},"Select a course...",-1)),(o(!0),n(x,null,k(N.courses,s=>(o(),n("option",{key:s.id,value:s.id},l(s.title)+" ("+l(s.subject)+" - "+l(s.level)+") ",9,Ve))),128))],40,Ee),[[W,r.value.course_id]]),T.value.course_id?(o(),n("p",Ae,l(T.value.course_id),1)):d("",!0)]),i.value?(o(),n("div",Ue,[e("div",Ne,[e("div",null,[e("h4",Te,l(i.value.title),1),e("div",Fe,[e("div",null,[t[14]||(t[14]=e("span",{class:"text-xs text-gray-500"},"Subject",-1)),e("p",Me,l(i.value.subject),1)]),e("div",null,[t[15]||(t[15]=e("span",{class:"text-xs text-gray-500"},"Level",-1)),e("p",De,l(i.value.level),1)]),e("div",null,[t[16]||(t[16]=e("span",{class:"text-xs text-gray-500"},"Duration",-1)),e("p",Le,l(i.value.estimated_duration_hours)+" hours",1)]),e("div",null,[t[17]||(t[17]=e("span",{class:"text-xs text-gray-500"},"Enrollment",-1)),e("p",Be,l(i.value.current_enrollment)+" / "+l(i.value.enrollment_limit||"Unlimited"),1)])])]),e("span",{class:Y(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",i.value.status==="active"?"bg-green-100 text-green-800":"bg-amber-100 text-amber-800"])},l(i.value.status),3)])])):d("",!0)])])]),e("div",Oe,[e("div",Pe,[e("div",ze,[t[19]||(t[19]=e("h3",{class:"text-lg font-semibold text-gray-900"},"2. Select Students",-1)),e("div",qe,[e("button",{onClick:P,type:"button",class:"text-sm text-blue-600 hover:text-blue-800"},l(F.value?"Deselect All":"Select All"),1),e("button",{onClick:t[1]||(t[1]=s=>w.value=!0),type:"button",class:"text-sm text-green-600 hover:text-green-800"}," Import from CSV ")])])]),e("div",Re,[e("div",Ke,[S(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>f.value=s),type:"text",placeholder:"Search students by name or email...",class:"block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",onInput:q},null,544),[[L,f.value]])]),e("div",Qe,[(o(!0),n(x,null,k(b.value,s=>(o(),n("div",{key:s.id,class:"flex items-center justify-between p-3 border border-gray-200 rounded-lg hover:bg-gray-50"},[e("div",Xe,[S(e("input",{id:`student-${s.id}`,"onUpdate:modelValue":t[3]||(t[3]=y=>u.value=y),value:s.id,type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,8,Ge),[[B,u.value]]),e("div",He,[e("div",Je,[e("span",We,l(s.name?.charAt(0).toUpperCase()||"S"),1)])]),e("div",null,[e("label",{for:`student-${s.id}`,class:"text-sm font-medium text-gray-900 cursor-pointer"},l(s.name),9,Ye),e("p",Ze,l(s.email),1),s.student_profile?(o(),n("div",et,[e("span",tt,l(s.student_profile.education_level||"Not specified"),1)])):d("",!0)])]),z(s.id)?(o(),n("div",st,[m(p(A),{class:"h-4 w-4"})])):d("",!0)]))),128)),b.value.length===0?(o(),n("div",lt,[m(p(oe),{class:"h-12 w-12 mx-auto text-gray-400"}),t[20]||(t[20]=e("h4",{class:"mt-2 text-sm font-medium text-gray-900"},"No students found",-1)),e("p",ot,l(f.value?"Try a different search term":"No students available"),1)])):d("",!0)]),e("div",nt,[e("span",null,l(u.value.length)+" of "+l(b.value.length)+" selected ",1),i.value&&i.value.enrollment_limit?(o(),n("span",at," Capacity: "+l(i.value.current_enrollment)+"/"+l(i.value.enrollment_limit),1)):d("",!0)])])])]),e("div",it,[e("div",rt,[t[23]||(t[23]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"3. Notification Settings")],-1)),e("div",dt,[e("div",ut,[e("div",ct,[e("div",mt,[S(e("input",{id:"send_notifications","onUpdate:modelValue":t[4]||(t[4]=s=>r.value.send_notifications=s),type:"checkbox",class:"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"},null,512),[[B,r.value.send_notifications]])]),t[21]||(t[21]=e("div",{class:"ml-3 text-sm"},[e("label",{for:"send_notifications",class:"font-medium text-gray-700"}," Send enrollment notifications "),e("p",{class:"text-gray-500"}," Students will receive an email and in-app notification ")],-1))]),r.value.send_notifications?(o(),n("div",vt,[t[22]||(t[22]=e("label",{for:"notification_message",class:"block text-sm font-medium text-gray-700"}," Custom Message (optional) ",-1)),S(e("textarea",{id:"notification_message","onUpdate:modelValue":t[5]||(t[5]=s=>r.value.notification_message=s),rows:"4",class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:"Add a personalized message for the students..."},null,512),[[L,r.value.notification_message]]),e("p",pt,l(r.value.notification_message?.length||0)+"/500 characters ",1)])):d("",!0)])])]),e("div",ft,[t[30]||(t[30]=e("div",{class:"px-6 py-4 border-b border-gray-200"},[e("h3",{class:"text-lg font-semibold text-gray-900"},"4. Confirm & Enroll")],-1)),e("div",xt,[e("div",gt,[e("div",_t,[t[27]||(t[27]=e("h4",{class:"text-sm font-medium text-blue-900 mb-2"},"Enrollment Summary",-1)),e("dl",bt,[e("div",yt,[t[24]||(t[24]=e("dt",{class:"text-sm text-blue-700"},"Course",-1)),e("dd",ht,l(i.value?.title||"Not selected"),1)]),e("div",wt,[t[25]||(t[25]=e("dt",{class:"text-sm text-blue-700"},"Students Selected",-1)),e("dd",kt,l(u.value.length),1)]),e("div",St,[t[26]||(t[26]=e("dt",{class:"text-sm text-blue-700"},"Notifications",-1)),e("dd",Ct,l(r.value.send_notifications?"Enabled":"Disabled"),1)])])]),e("button",{onClick:R,disabled:!M.value||_.value,class:"w-full flex justify-center items-center px-4 py-3 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed"},[_.value?(o(),n(x,{key:0},[m(p(U),{class:"animate-spin h-4 w-4 mr-2"}),t[28]||(t[28]=j(" Processing... ",-1))],64)):(o(),n(x,{key:1},[j(" Enroll "+l(u.value.length)+" Student(s) ",1)],64))],8,jt),i.value?(o(),n("div",$t,[e("p",It,[m(p(ne),{class:"h-4 w-4 mr-1"}),t[29]||(t[29]=j(" Students already enrolled in this course will be skipped. ",-1))]),i.value.enrollment_limit?(o(),n("p",Et," Available spots: "+l(Math.max(0,i.value.enrollment_limit-i.value.current_enrollment)),1)):d("",!0)])):d("",!0)])])])])])])]),m(O,{show:w.value,onClose:t[7]||(t[7]=s=>w.value=!1)},{default:C(()=>[e("div",Vt,[t[38]||(t[38]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Import Students from CSV",-1)),t[39]||(t[39]=e("div",{class:"mb-6"},[e("p",{class:"text-sm text-gray-600 mb-3"}," Upload a CSV file with student emails. The file should contain one email per line: "),e("pre",{class:"bg-gray-100 p-4 rounded text-sm overflow-x-auto"},`student1@example.com
student2@example.com
student3@example.com`),e("p",{class:"mt-3 text-xs text-gray-500"}," Only active students with valid emails will be imported. ")],-1)),e("div",At,[e("input",{ref_key:"fileInput",ref:E,type:"file",accept:".csv,.txt",onChange:K,class:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"},null,544)]),I.value?(o(),n("div",Ut,[e("div",Nt,[t[31]||(t[31]=e("span",null,"Uploading and processing...",-1)),m(p(U),{class:"animate-spin h-4 w-4"})])])):d("",!0),c.value?(o(),n("div",Tt,[e("div",Ft,[t[36]||(t[36]=e("h4",{class:"text-sm font-medium text-gray-900 mb-2"},"Upload Results",-1)),e("div",Mt,[e("div",null,[t[32]||(t[32]=e("span",{class:"text-gray-600"},"Total entries:",-1)),e("span",Dt,l(c.value.total_processed),1)]),e("div",null,[t[33]||(t[33]=e("span",{class:"text-green-600"},"Valid students:",-1)),e("span",Lt,l(c.value.valid_count),1)]),e("div",null,[t[34]||(t[34]=e("span",{class:"text-red-600"},"Invalid entries:",-1)),e("span",Bt,l(c.value.invalid_count),1)])]),c.value.invalid_entries?.length?(o(),n("div",Ot,[e("details",Pt,[t[35]||(t[35]=e("summary",{class:"text-red-600 cursor-pointer"},"View issues",-1)),e("ul",zt,[(o(!0),n(x,null,k(c.value.invalid_entries.slice(0,5),(s,y)=>(o(),n("li",{key:y}," â€¢ "+l(s),1))),128)),c.value.invalid_entries.length>5?(o(),n("li",qt," ... and "+l(c.value.invalid_entries.length-5)+" more ",1)):d("",!0)])])])):d("",!0)]),c.value.valid_students?.length?(o(),n("div",Rt,[t[37]||(t[37]=e("h5",{class:"text-sm font-medium text-gray-900 mb-2"},"Students to be added:",-1)),e("div",Kt,[(o(!0),n(x,null,k(c.value.valid_students,s=>(o(),n("div",{key:s.id,class:"flex items-center justify-between p-2 bg-white border border-gray-200 rounded"},[e("div",null,[e("div",Qt,l(s.name),1),e("div",Xt,l(s.email),1)]),m(p(A),{class:"h-4 w-4 text-green-500"})]))),128))])])):d("",!0)])):d("",!0),e("div",Gt,[e("button",{onClick:t[6]||(t[6]=s=>w.value=!1),type:"button",class:"px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-md hover:bg-gray-50"}," Cancel "),c.value?.valid_students?.length?(o(),n("button",{key:0,onClick:Q,disabled:!i.value,class:"px-4 py-2 text-sm font-medium text-white bg-green-600 border border-transparent rounded-md hover:bg-green-700 disabled:opacity-50"}," Add "+l(c.value.valid_count)+" Student(s) ",9,Ht)):d("",!0)])])]),_:1},8,["show"]),m(O,{show:_.value,onClose:t[8]||(t[8]=s=>_.value=!1)},{default:C(()=>[e("div",Jt,[m(p(U),{class:"animate-spin h-12 w-12 text-blue-600 mx-auto mb-4"}),t[40]||(t[40]=e("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Enrolling Students",-1)),e("p",Wt," Please wait while we process "+l(u.value.length)+" enrollment(s)... ",1),e("div",Yt,[e("div",{class:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:Z({width:`${h.value}%`})},null,4)]),t[41]||(t[41]=e("p",{class:"mt-2 text-xs text-gray-500"}," This may take a moment depending on the number of students. ",-1))])]),_:1},8,["show"])]),_:1}))}};export{gs as default};
