import{f as n,a as e,o as a,r as v,d as D,l as H,R as j,m as P,g as f,e as k,s as S,b as p,h as r,F as E,j as M,t as m,B as se,z as Q,i as Y,n as z,u as re,c as L,w as le,p as oe,q as ae}from"./app-B55pdyKV.js";import{A as ne}from"./AdminLayout-B6RzOH9D.js";import{r as I}from"./CheckIcon-CkU7cnM5.js";import{r as G}from"./XMarkIcon-DPQH_s_L.js";import{r as ie}from"./PlusIcon-XZm8LGLx.js";import{r as J}from"./UserGroupIcon-N8hl-FFH.js";import{r as W}from"./ExclamationTriangleIcon-DBoxjhPY.js";import{r as de}from"./CheckCircleIcon-CRW3E5nv.js";import{r as ue}from"./UserIcon-_4Xna5Gt.js";import{r as ce}from"./UsersIcon-DwVmGstj.js";import{r as me}from"./PaperAirplaneIcon-DsvK1uxH.js";import{r as be}from"./ArrowPathIcon-CcjCGqWP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./ChatBubbleLeftRightIcon-CCa7BYB8.js";import"./ChartBarIcon-B5U67zay.js";import"./CurrencyDollarIcon-DQxXsKGG.js";import"./EyeIcon-Bu4kIzD-.js";function X(y,h){return a(),n("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M8.25 15 12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"})])}const pe={class:"relative"},ge={class:"absolute inset-y-0 right-0 flex items-center pr-2"},fe={key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},ve=["onMousedown"],ye={class:"block truncate"},xe={key:0,class:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600"},he={key:0,class:"mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200"},_e={class:"flex items-center justify-between"},we={class:"flex items-center space-x-3"},ke={class:"flex-shrink-0 h-8 w-8 bg-blue-500 rounded-full flex items-center justify-center"},$e={class:"text-xs font-medium text-white"},Se={class:"text-sm font-medium text-gray-900"},Ue={class:"text-xs text-gray-500"},Ve={class:"text-xs text-gray-400 capitalize mt-1"},Ce={key:1,class:"mt-1 text-sm text-red-600"},je={__name:"UserSearch",props:{modelValue:[Number,String],error:String},emits:["update:modelValue"],setup(y,{emit:h}){const l=y,$=h,g=v(!1),u=v(""),t=v([]),s=v(null);let T=null;const _=async c=>{if(!c||c.length<2){t.value=[];return}try{const b=await j.get(route("admin.users.search"),{params:{search:c,limit:10}});t.value=b.data}catch(b){console.error("Error searching users:",b),t.value=[]}},w=()=>{clearTimeout(T),T=setTimeout(()=>{_(u.value)},300)},U=()=>{setTimeout(()=>{g.value=!1},200)},N=c=>{s.value=c,$("update:modelValue",c.id),g.value=!1,u.value="",t.value=[]},A=()=>{s.value=null,$("update:modelValue",null),u.value=""},B=c=>c.split(" ").map(b=>b.charAt(0)).join("").toUpperCase().slice(0,2),R=D(()=>t.value.filter(c=>c.name.toLowerCase().includes(u.value.toLowerCase())||c.email.toLowerCase().includes(u.value.toLowerCase())));return H(async()=>{if(l.modelValue)try{const c=await j.post(route("admin.users.by-ids"),{ids:[l.modelValue]});c.data.length>0&&(s.value=c.data[0])}catch(c){console.error("Error fetching pre-selected user:",c)}}),P(()=>l.modelValue,c=>{!c&&s.value&&(s.value=null,u.value="")}),(c,b)=>(a(),n("div",null,[b[2]||(b[2]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Select User ",-1)),e("div",pe,[k(e("input",{"onUpdate:modelValue":b[0]||(b[0]=x=>u.value=x),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Search users by name or email...",onInput:w,onFocus:b[1]||(b[1]=x=>g.value=!0),onBlur:U},null,544),[[S,u.value]]),e("div",ge,[p(r(X),{class:"h-5 w-5 text-gray-400"})]),g.value&&R.value.length>0?(a(),n("div",fe,[(a(!0),n(E,null,M(R.value,x=>(a(),n("div",{key:x.id,class:"relative cursor-default select-none py-2 pl-10 pr-4 hover:bg-blue-600 hover:text-white text-gray-900",onMousedown:q=>N(x)},[e("span",ye,m(x.name)+" ("+m(x.email)+") ",1),s.value&&s.value.id===x.id?(a(),n("span",xe,[p(r(I),{class:"h-5 w-5"})])):f("",!0)],40,ve))),128))])):f("",!0)]),s.value?(a(),n("div",he,[e("div",_e,[e("div",we,[e("div",ke,[e("span",$e,m(B(s.value.name)),1)]),e("div",null,[e("div",Se,m(s.value.name),1),e("div",Ue,m(s.value.email),1),e("div",Ve,m(s.value.roles?.[0]?.name||"No role"),1)])]),e("button",{type:"button",onClick:A,class:"text-red-400 hover:text-red-600 transition-colors duration-150 p-1"},[p(r(G),{class:"h-4 w-4"})])])])):f("",!0),y.error?(a(),n("div",Ce,m(y.error),1)):f("",!0)]))}},Ee={class:"space-y-4"},Me={class:"flex space-x-4"},ze={class:"flex-1"},Te={class:"relative"},Ne=["onKeydown"],Re={class:"absolute inset-y-0 right-0 flex items-center pr-2"},Ae={key:0,class:"absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none"},Be=["onClick"],Fe={class:"block truncate"},Le={class:"text-xs opacity-75 capitalize"},Ie={key:0,class:"absolute inset-y-0 left-0 flex items-center pl-3 text-blue-600"},qe={key:1,class:"absolute z-10 mt-1 w-full rounded-md bg-white py-2 px-4 text-sm text-gray-500"},Oe={key:2,class:"absolute z-10 mt-1 w-full rounded-md bg-white py-2 px-4 text-sm text-gray-500"},Ke={class:"flex items-end"},De=["disabled"],He={key:0,class:"bg-gray-50 rounded-lg p-4"},Pe={class:"flex justify-between items-center mb-3"},Qe={class:"text-sm font-medium text-gray-700"},Ye={class:"space-y-2 max-h-60 overflow-y-auto"},Ge={class:"flex items-center space-x-3"},Je={class:"flex-shrink-0 h-8 w-8 bg-blue-500 rounded-full flex items-center justify-center"},We={class:"text-xs font-medium text-white"},Xe={class:"text-sm font-medium text-gray-900"},Ze={class:"text-xs text-gray-500"},et={class:"text-xs text-gray-400 capitalize mt-1"},tt=["onClick"],st={key:1,class:"bg-gray-50 rounded-lg p-8 text-center border-2 border-dashed border-gray-300"},rt={class:"border-t pt-4"},lt={class:"grid grid-cols-2 md:grid-cols-4 gap-2"},ot=["onClick","disabled"],at={class:"text-sm font-medium text-gray-700 capitalize group-hover:text-blue-700"},nt={key:2,class:"p-3 bg-red-50 border border-red-200 rounded-lg"},it={class:"flex items-center"},dt={class:"text-sm text-red-700"},ut={__name:"UserMultiSelect",props:{modelValue:{type:Array,default:()=>[]},error:String},emits:["update:modelValue"],setup(y,{emit:h}){const l=y,$=h,g=v(""),u=v(null),t=v([]),s=v([]),T=v(["admin","student","tutor","organization"]),_=v(new Set),w=v(!1),U=v(!1);let N=null;const A=async o=>{if(!o||o.length<2){t.value=[],w.value=!1;return}w.value=!0;try{const i=await j.get(route("admin.users.search"),{params:{search:o,limit:20}});t.value=i.data}catch(i){console.error("Error searching users:",i),t.value=[]}finally{w.value=!1}},B=()=>{clearTimeout(N),N=setTimeout(()=>{A(g.value)},300)},R=()=>{b.value.length===1&&c(b.value[0])},c=o=>{u.value=o,x()},b=D(()=>t.value.filter(o=>!s.value.find(i=>i.id===o.id))),x=()=>{u.value&&!s.value.find(o=>o.id===u.value.id)&&(s.value.push(u.value),V(),u.value=null,g.value="",t.value=[])},q=o=>{s.value=s.value.filter(i=>i.id!==o),K(),V()},O=()=>{s.value=[],_.value.clear(),V()},Z=o=>o.split(" ").map(i=>i.charAt(0)).join("").toUpperCase().slice(0,2),V=()=>{$("update:modelValue",s.value.map(o=>o.id))},ee=async o=>{if(_.value.has(o))s.value=s.value.filter(i=>!i.roles?.some(d=>d.name===o)),_.value.delete(o),V();else{U.value=!0;try{(await j.get(route("admin.users.by-role",{role:o}))).data.forEach(C=>{s.value.find(te=>te.id===C.id)||s.value.push(C)}),_.value.add(o),V()}catch(i){console.error("Error fetching users by role:",i)}finally{U.value=!1}}},F=o=>_.value.has(o),K=()=>{_.value.clear(),s.value.forEach(o=>{o.roles?.forEach(i=>{_.value.add(i.name)})})};return P(()=>l.modelValue,o=>{o.length===0&&s.value.length>0&&(s.value=[],_.value.clear())},{deep:!0}),H(async()=>{if(l.modelValue&&l.modelValue.length>0)try{const o=await j.post(route("admin.users.by-ids"),{ids:l.modelValue});s.value=o.data,K()}catch(o){console.error("Error fetching pre-selected users:",o)}}),(o,i)=>(a(),n("div",Ee,[e("div",Me,[e("div",ze,[i[1]||(i[1]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Search Users ",-1)),e("div",Te,[k(e("input",{"onUpdate:modelValue":i[0]||(i[0]=d=>g.value=d),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Search by name or email...",onInput:B,onKeydown:se(Q(R,["prevent"]),["enter"])},null,40,Ne),[[S,g.value]]),e("div",Re,[p(r(X),{class:"h-5 w-5 text-gray-400"})]),b.value.length>0&&g.value.length>0?(a(),n("div",Ae,[(a(!0),n(E,null,M(b.value,d=>(a(),n("div",{key:d.id,class:"relative cursor-default select-none py-2 pl-10 pr-4 hover:bg-blue-600 hover:text-white text-gray-900",onClick:C=>c(d)},[e("span",Fe,[Y(m(d.name)+" ("+m(d.email)+") ",1),e("span",Le," - "+m(d.roles?.[0]?.name||"No role"),1)]),u.value&&u.value.id===d.id?(a(),n("span",Ie,[p(r(I),{class:"h-5 w-5"})])):f("",!0)],8,Be))),128))])):f("",!0),w.value?(a(),n("div",qe," Searching... ")):f("",!0),g.value.length>=2&&b.value.length===0&&!w.value?(a(),n("div",Oe," No users found ")):f("",!0)])]),e("div",Ke,[e("button",{type:"button",onClick:x,disabled:!u.value,class:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-150"},[p(r(ie),{class:"h-4 w-4"})],8,De)])]),s.value.length>0?(a(),n("div",He,[e("div",Pe,[e("h3",Qe," Selected Users ("+m(s.value.length)+") ",1),e("button",{type:"button",onClick:O,class:"text-sm text-red-600 hover:text-red-800 transition-colors duration-150"}," Clear All ")]),e("div",Ye,[(a(!0),n(E,null,M(s.value,d=>(a(),n("div",{key:d.id,class:"flex items-center justify-between bg-white p-3 rounded-lg border border-gray-200 shadow-sm"},[e("div",Ge,[e("div",Je,[e("span",We,m(Z(d.name)),1)]),e("div",null,[e("div",Xe,m(d.name),1),e("div",Ze,m(d.email),1),e("div",et,m(d.roles?.[0]?.name||"No role"),1)])]),e("button",{type:"button",onClick:C=>q(d.id),class:"text-red-400 hover:text-red-600 transition-colors duration-150 p-1"},[p(r(G),{class:"h-4 w-4"})],8,tt)]))),128))])])):(a(),n("div",st,[p(r(J),{class:"mx-auto h-12 w-12 text-gray-400"}),i[2]||(i[2]=e("h3",{class:"mt-2 text-sm font-medium text-gray-900"},"No users selected",-1)),i[3]||(i[3]=e("p",{class:"mt-1 text-sm text-gray-500"}," Search and add users to send them emails. ",-1))])),e("div",rt,[e("div",{class:"flex items-center justify-between mb-3"},[i[4]||(i[4]=e("label",{class:"block text-sm font-medium text-gray-700"}," Quick Select by Role ",-1)),e("button",{type:"button",onClick:O,class:"text-xs text-red-600 hover:text-red-800 transition-colors duration-150"}," Clear All ")]),e("div",lt,[(a(!0),n(E,null,M(T.value,d=>(a(),n("button",{key:d,type:"button",onClick:C=>ee(d),disabled:U.value,class:z(["flex items-center justify-between p-3 border border-gray-300 rounded-lg hover:border-blue-500 hover:bg-blue-50 transition-colors duration-150 group disabled:opacity-50 disabled:cursor-not-allowed",{"border-blue-500 bg-blue-50":F(d),"border-gray-300 bg-white":!F(d)}])},[e("span",at,m(d),1),p(r(I),{class:z(["h-4 w-4",F(d)?"text-blue-600":"text-gray-400"])},null,8,["class"])],10,ot))),128))])]),y.error?(a(),n("div",nt,[e("div",it,[p(r(W),{class:"h-4 w-4 text-red-400 mr-2"}),e("span",dt,m(y.error),1)])])):f("",!0)]))}},ct={class:"py-6"},mt={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8"},bt={key:0,class:"mb-6 p-4 bg-green-50 border border-green-200 rounded-lg"},pt={class:"flex items-center"},gt={class:"text-green-800"},ft={key:1,class:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg"},vt={class:"flex items-center"},yt={class:"text-red-800"},xt={class:"bg-white shadow rounded-lg overflow-hidden"},ht={class:"p-6 space-y-6"},_t={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},wt={class:"flex items-center"},kt={class:"flex items-center"},$t={class:"flex items-center"},St={key:0},Ut=["value"],Vt={key:1},Ct={key:2},jt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Et={class:"px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3"},Mt=["disabled"],Gt={__name:"Index",props:{roles:Array,errors:Object},setup(y){const h=v(!1),l=re({type:"role",role:"",user_id:null,user_ids:[],subject:"",message:"",from_email:"",from_name:""}),$=()=>{h.value=!0,l.post(route("admin.email.send"),{preserveScroll:!0,onFinish:()=>{h.value=!1,Object.keys(l.errors).length||g()}})},g=()=>{l.reset(),l.type="role"};return(u,t)=>(a(),L(ne,null,{default:le(()=>[p(r(oe),{title:"Email Management"}),e("div",ct,[e("div",mt,[t[23]||(t[23]=e("div",{class:"mb-8"},[e("div",{class:"flex justify-between items-center"},[e("div",null,[e("h1",{class:"text-3xl font-bold text-gray-900"},"Email Management"),e("p",{class:"mt-2 text-gray-600"}," Send emails to users based on roles or individually ")])])],-1)),u.$page.props.flash.success?(a(),n("div",bt,[e("div",pt,[p(r(de),{class:"h-5 w-5 text-green-400 mr-2"}),e("span",gt,m(u.$page.props.flash.success),1)])])):f("",!0),u.$page.props.flash.error?(a(),n("div",ft,[e("div",vt,[p(r(W),{class:"h-5 w-5 text-red-400 mr-2"}),e("span",yt,m(u.$page.props.flash.error),1)])])):f("",!0),e("div",xt,[e("form",{onSubmit:Q($,["prevent"])},[e("div",ht,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Send To ",-1)),e("div",_t,[e("button",{type:"button",onClick:t[0]||(t[0]=s=>r(l).type="role"),class:z(["p-4 border rounded-lg text-left transition-colors duration-150",r(l).type==="role"?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"])},[e("div",wt,[p(r(J),{class:"h-5 w-5 text-gray-400 mr-3"}),t[10]||(t[10]=e("div",null,[e("div",{class:"font-medium text-gray-900"},"By Role"),e("div",{class:"text-sm text-gray-500"},"Send to all users with a specific role")],-1))])],2),e("button",{type:"button",onClick:t[1]||(t[1]=s=>r(l).type="user"),class:z(["p-4 border rounded-lg text-left transition-colors duration-150",r(l).type==="user"?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"])},[e("div",kt,[p(r(ue),{class:"h-5 w-5 text-gray-400 mr-3"}),t[11]||(t[11]=e("div",null,[e("div",{class:"font-medium text-gray-900"},"Single User"),e("div",{class:"text-sm text-gray-500"},"Send to a specific user")],-1))])],2),e("button",{type:"button",onClick:t[2]||(t[2]=s=>r(l).type="multiple"),class:z(["p-4 border rounded-lg text-left transition-colors duration-150",r(l).type==="multiple"?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-gray-400"])},[e("div",$t,[p(r(ce),{class:"h-5 w-5 text-gray-400 mr-3"}),t[12]||(t[12]=e("div",null,[e("div",{class:"font-medium text-gray-900"},"Multiple Users"),e("div",{class:"text-sm text-gray-500"},"Send to selected users")],-1))])],2)])]),r(l).type==="role"?(a(),n("div",St,[t[15]||(t[15]=e("label",{for:"role",class:"block text-sm font-medium text-gray-700 mb-2"}," Select Role ",-1)),k(e("select",{id:"role","onUpdate:modelValue":t[3]||(t[3]=s=>r(l).role=s),class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[t[14]||(t[14]=e("option",{value:""},"Select a role",-1)),(a(!0),n(E,null,M(y.roles,s=>(a(),n("option",{key:s,value:s,class:"capitalize"},m(s),9,Ut))),128))],512),[[ae,r(l).role]])])):f("",!0),r(l).type==="user"?(a(),n("div",Vt,[t[16]||(t[16]=e("label",{for:"user",class:"block text-sm font-medium text-gray-700 mb-2"}," Select User ",-1)),p(je,{modelValue:r(l).user_id,"onUpdate:modelValue":t[4]||(t[4]=s=>r(l).user_id=s),error:y.errors.user_id},null,8,["modelValue","error"])])):f("",!0),r(l).type==="multiple"?(a(),n("div",Ct,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Select Users ",-1)),p(ut,{modelValue:r(l).user_ids,"onUpdate:modelValue":t[5]||(t[5]=s=>r(l).user_ids=s),error:y.errors.user_ids},null,8,["modelValue","error"])])):f("",!0),e("div",jt,[e("div",null,[t[18]||(t[18]=e("label",{for:"from_email",class:"block text-sm font-medium text-gray-700 mb-2"}," From Email (Optional) ",-1)),k(e("input",{id:"from_email","onUpdate:modelValue":t[6]||(t[6]=s=>r(l).from_email=s),type:"email",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"noreply@example.com"},null,512),[[S,r(l).from_email]])]),e("div",null,[t[19]||(t[19]=e("label",{for:"from_name",class:"block text-sm font-medium text-gray-700 mb-2"}," From Name (Optional) ",-1)),k(e("input",{id:"from_name","onUpdate:modelValue":t[7]||(t[7]=s=>r(l).from_name=s),type:"text",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"AI Course Platform"},null,512),[[S,r(l).from_name]])])]),e("div",null,[t[20]||(t[20]=e("label",{for:"subject",class:"block text-sm font-medium text-gray-700 mb-2"}," Subject ",-1)),k(e("input",{id:"subject","onUpdate:modelValue":t[8]||(t[8]=s=>r(l).subject=s),type:"text",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter email subject"},null,512),[[S,r(l).subject]])]),e("div",null,[t[21]||(t[21]=e("label",{for:"message",class:"block text-sm font-medium text-gray-700 mb-2"}," Message ",-1)),k(e("textarea",{id:"message","onUpdate:modelValue":t[9]||(t[9]=s=>r(l).message=s),rows:"10",required:"",class:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter your email message... (HTML supported)"},null,512),[[S,r(l).message]]),t[22]||(t[22]=e("p",{class:"mt-1 text-sm text-gray-500"}," You can use HTML tags for formatting. Basic styling is supported. ",-1))])]),e("div",Et,[e("button",{type:"button",onClick:g,class:"px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Reset "),e("button",{type:"submit",disabled:h.value,class:"inline-flex items-center px-4 py-2 bg-blue-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-blue-700 focus:bg-blue-700 active:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition ease-in-out duration-150 disabled:opacity-50"},[h.value?(a(),L(r(be),{key:1,class:"h-4 w-4 mr-2 animate-spin"})):(a(),L(r(me),{key:0,class:"h-4 w-4 mr-2"})),Y(" "+m(h.value?"Sending...":"Send Email"),1)],8,Mt)])],32)])])])]),_:1}))}};export{Gt as default};
