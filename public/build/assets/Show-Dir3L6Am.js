import{f as a,a as e,o as r,g as m,m as U,N as $,c as T,w as b,b as f,i,q,e as A,F as v,k as w,t as c,s as z,y as M,n as g,j as _,h as k,A as I,C as E,x as H,L as K,z as C}from"./app-RlMDLPbN.js";import{S as G}from"./StudentLayout-CCnufd-5.js";import{r as O}from"./PlusIcon-D2Joks_y.js";import{c as P}from"./XMarkIcon-CrAZ_pzL.js";import"./CheckCircleIcon-Cl5cCiGi.js";import"./ExclamationTriangleIcon-D2VMaPqz.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./UserIcon-BHi175d0.js";import"./ChatBubbleLeftRightIcon-CsttcNJR.js";import"./BellIcon-BED81iOW.js";import"./CreditCardIcon-BOpYhrSa.js";function Q(n,l){return r(),a("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24","stroke-width":"1.5",stroke:"currentColor","aria-hidden":"true","data-slot":"icon"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round",d:"M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5"})])}const R={class:"min-h-screen bg-gradient-to-br from-slate-50 to-emerald-50"},Z={class:"flex h-screen"},J={class:"w-80 bg-white border-r border-gray-200 flex flex-col"},W={class:"p-4 border-b border-gray-200"},X=["value"],Y={class:"flex-1 overflow-auto p-4"},ee={class:"space-y-2"},te={class:"text-sm font-medium text-gray-900 truncate"},se={class:"text-xs text-gray-500 mt-1"},oe={class:"p-4 border-t border-gray-200"},re={class:"flex-1 flex flex-col"},ae={class:"bg-white border-b border-gray-200 px-6 py-4"},ne={class:"flex items-center justify-between"},le={class:"text-xl font-bold text-gray-900"},de={key:0,class:"text-sm text-gray-600 mt-1"},ie=["innerHTML"],ce={key:0,class:"ml-2 text-amber-500"},ue={key:0,class:"flex justify-start"},me={class:"border-t border-gray-200 p-4 bg-white"},fe={class:"flex-1"},he=["onKeydown","disabled"],ge=["disabled"],Ae={__name:"Show",props:{chat_session:Object,related_outlines:Array,recent_sessions:Array},setup(n){const l=n,h=m(null),d=m(""),u=m(!1),p=m(!1),x=m(l.chat_session.course_outline_id);let y=null;const j=o=>o.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`(.*?)`/g,'<code class="bg-gray-100 px-1 rounded">$1</code>').replace(/\n/g,"<br>"),L=o=>new Date(o).toLocaleDateString("en-US",{month:"short",day:"numeric"}),B=o=>new Date(o).toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit"}),D=()=>{K(()=>{h.value&&(h.value.scrollTop=h.value.scrollHeight)})},S=async()=>{if(!d.value.trim()||u.value)return;const o=d.value.trim();d.value="",u.value=!0,p.value=!0;try{(await axios.post(route("student.chat.send-message",l.chat_session.id),{message:o})).data.success&&C.reload()}catch(t){console.error("Failed to send message:",t),p.value=!1}finally{u.value=!1}},N=async()=>{try{await axios.post(route("student.chat.update-context",l.chat_session.id),{outline_id:x.value})}catch(o){console.error("Failed to update context:",o)}},V=()=>{C.post(route("student.chat.close",l.chat_session.id))},F=()=>{y=setInterval(async()=>{try{(await axios.get(route("student.chat.messages",l.chat_session.id))).data.messages.length!==l.chat_session.messages.length&&C.reload()}catch(o){console.error("Failed to poll messages:",o)}},5e3)};return U(()=>{D(),F()}),$(()=>{y&&clearInterval(y)}),(o,t)=>(r(),T(G,null,{default:b(()=>[e("div",R,[f(i(q),{title:"AI Tutor Chat"}),e("div",Z,[e("div",J,[t[7]||(t[7]=e("div",{class:"p-4 border-b border-gray-200"},[e("h2",{class:"text-lg font-bold text-gray-900"},"AI Tutor"),e("p",{class:"text-sm text-gray-600 mt-1"}," Ask questions about your course ")],-1)),e("div",W,[t[3]||(t[3]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Course Context ",-1)),A(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>x.value=s),onChange:N,class:"w-full px-3 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 shadow-sm"},[t[2]||(t[2]=e("option",{value:""},"General Questions",-1)),(r(!0),a(v,null,w(n.related_outlines,s=>(r(),a("option",{key:s.id,value:s.id},c(s.title),9,X))),128))],544),[[z,x.value]]),t[4]||(t[4]=e("p",{class:"text-xs text-gray-500 mt-2"}," Setting context helps the AI provide more relevant answers ",-1))]),e("div",Y,[t[5]||(t[5]=e("h3",{class:"text-sm font-medium text-gray-900 mb-3"}," Recent Chats ",-1)),e("div",ee,[(r(!0),a(v,null,w(o.recentSessions,s=>(r(),T(i(M),{key:s.id,href:o.route("student.chat.show",s.id),class:g(["block p-3 rounded-lg border border-gray-200 hover:border-emerald-300 hover:bg-emerald-50 transition-colors",{"border-emerald-300 bg-emerald-50":s.id===n.chat_session.id}])},{default:b(()=>[e("p",te,c(s.topic_context||"General Chat"),1),e("p",se,c(L(s.last_activity_at)),1)]),_:2},1032,["href","class"]))),128))])]),e("div",oe,[f(i(M),{href:o.route("student.chat.create"),class:"w-full flex items-center justify-center px-4 py-2.5 text-sm font-semibold text-white bg-gradient-to-r from-emerald-600 to-teal-600 rounded-lg hover:from-emerald-700 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 shadow-sm hover:shadow-md transition-all duration-200"},{default:b(()=>[f(i(O),{class:"h-4 w-4 mr-2"}),t[6]||(t[6]=_(" New Chat ",-1))]),_:1},8,["href"])])]),e("div",re,[e("div",ae,[e("div",ne,[e("div",null,[e("h1",le,c(n.chat_session.topic_context||"AI Tutor"),1),n.chat_session.course?(r(),a("p",de,c(n.chat_session.course.title),1)):k("",!0)]),e("button",{onClick:V,class:"inline-flex items-center px-3 py-2 border border-emerald-300 rounded-lg text-sm font-medium text-emerald-700 bg-white hover:bg-emerald-50 focus:outline-none focus:ring-2 focus:ring-emerald-500 shadow-sm hover:shadow-md transition-colors"},[f(i(P),{class:"h-4 w-4 mr-1"}),t[8]||(t[8]=_(" End Chat ",-1))])])]),e("div",{ref_key:"messagesContainer",ref:h,class:"flex-1 overflow-auto p-6 space-y-4"},[(r(!0),a(v,null,w(n.chat_session.messages,s=>(r(),a("div",{key:s.id,class:g(["flex",{"justify-end":s.sender_type==="user","justify-start":s.sender_type!=="user"}])},[e("div",{class:g(["max-w-3/4 rounded-xl px-4 py-3 shadow-sm",{"bg-gradient-to-r from-emerald-600 to-teal-600 text-white":s.sender_type==="user","bg-white border border-gray-200":s.sender_type!=="user"}])},[e("div",{innerHTML:j(s.message)},null,8,ie),e("p",{class:g(["text-xs mt-1",{"text-emerald-200":s.sender_type==="user","text-gray-500":s.sender_type!=="user"}])},[_(c(B(s.created_at))+" ",1),s.sender_type==="ai"&&!s.is_related_to_topic?(r(),a("span",ce," (May be off-topic) ")):k("",!0)],2)],2)],2))),128)),p.value?(r(),a("div",ue,[...t[9]||(t[9]=[e("div",{class:"bg-white border border-gray-200 rounded-xl px-4 py-3 shadow-sm"},[e("div",{class:"flex space-x-1"},[e("div",{class:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce",style:{"animation-delay":"0.1s"}}),e("div",{class:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce",style:{"animation-delay":"0.2s"}}),e("div",{class:"w-2 h-2 bg-emerald-400 rounded-full animate-bounce",style:{"animation-delay":"0.3s"}})])],-1)])])):k("",!0)],512),e("div",me,[e("form",{onSubmit:I(S,["prevent"]),class:"flex space-x-4"},[e("div",fe,[A(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=s=>d.value=s),onKeydown:E(I(S,["exact","prevent"]),["enter"]),rows:"2",placeholder:"Ask a question about your course...",class:"w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 resize-none shadow-sm",disabled:u.value},null,40,he),[[H,d.value]])]),e("button",{type:"submit",disabled:!d.value.trim()||u.value,class:"self-end px-6 py-2.5 bg-gradient-to-r from-emerald-600 to-teal-600 text-white rounded-lg hover:from-emerald-700 hover:to-teal-700 focus:outline-none focus:ring-2 focus:ring-emerald-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all duration-200 shadow-sm hover:shadow-md"},[f(i(Q),{class:"h-4 w-4"})],8,ge)],32),t[10]||(t[10]=e("p",{class:"text-xs text-gray-500 mt-2"}," Press Enter to send. The AI will focus on your current course context. ",-1))])])])])]),_:1}))}};export{Ae as default};
